<div class="section">
  <h2>Members List</h2>

  <div class="section-content">
    <ul>
      <? for (let i = 0; i < props.members.length; i++) { ?>
        <li><?= props.members[i].profileName ?> <strong>(<?= props.members[i].scriptVersion ?>)</strong></li>
      <? } ?>
    </ul>

    <button class="button" onclick="openModal();">Add member</button>
  </div>
</div>

<div class="modal" id="add-member-modal">
  <div class="modal-content">
    <div class="modal-title-bar">
      <h2>Add a member</h2>
      <div class="close-modal" onclick="closeModal();">
        <?!= include('pages/components/closeIcon') ?>
      </div>
    </div>

    <div class="add-member-form">
      <label for="password" class="form-label">
        <h3>Password*</h3>
        <input class="text-field" type="password" id="password" placeholder="Your quest manager password*" required>
      </label>

      <label for="member-link" class="form-label">
        <h3>Your party member's Quest Manager link</h3>
        <input class="text-field" type="text" id="member-link" placeholder="Enter link they gave you">
      </label>

      <button id="submit-button" class="button" onclick="submitMembersForm()">Add Member</button>

      <i id="loading-bar"></i>

    </div>
  </div>
</div>

<script>
  (() => {
    window.submitMembersForm = () => {
      const loadingBar = document.getElementById('loading-bar');
      const submitButton = document.getElementById('submit-button');

      const password = document.getElementById('password').value;
      const memberLink = document.getElementById('member-link').value;

      loadingBar.innerHTML = 'Loading...';
      submitButton.style.pointerEvents = 'none';

      google.script.run.withSuccessHandler((members) => {
        document.getElementById('loading-bar').innerHTML = 'Member added!';
        submitButton.style.pointerEvents = 'auto';
        password.value = '';
        memberLink.value = '';

        reloadPage();
      }).withFailureHandler((error) => {
        document.getElementById('loading-bar').innerHTML = error.message;
        submitButton.style.pointerEvents = 'auto';
      }).props_addNewMember(password, memberLink);
    }

    window.addEventListener('click', (event) => {
      const modal = document.getElementById('add-member-modal');
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });

    window.openModal = () => {
      document.getElementById('add-member-modal').style.display = 'block';
    }

    window.closeModal = () => {
      document.getElementById('add-member-modal').style.display = 'none';
    }
  })()
</script>