<? const globalData = getGlobalPageData(); ?>

<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <?!= include('css/styles'); ?>
  </head>
  <body>
    <script>
      const sumbitSettings = () => {
        const password = document.getElementById('password').value;
        const questStartThreshold = document.getElementById('questStartThreshold').value;

        document.getElementById('loading-bar').innerHTML = 'Loading...';

        google.script.run.withSuccessHandler(() => {
          document.getElementById('loading-bar').innerHTML = 'Settings updated!';
          password.value = '';
          questStartThreshold.value = '';
        }).withFailureHandler((error) => {
          document.getElementById('loading-bar').innerHTML = error.message;
        }).updateSettings(password, questStartThreshold);
      }
    </script>

    <div class="header">
      <div class="header-title">
        <h4><?= globalData.scriptName ?></h4>
        <i>by <a class="link" href="https://habitica.com/profile/90c987f2-cf51-442f-b932-3c4194d56ad6">Kanguste</a></i>
      </div>
      <nav>
        <ul class="navigation-buttons">
          <li><a class="button" href="<?= globalData.mainPageUrl ?>">Main</a></li>
          <li><a class="button" href="<?= globalData.settingsPageUrl ?>">Settings</a></li>
        </ul>
      </nav>
    </div>
    
    <main>
      <center>
        <div class="section">
          <h2>Settings</h2>
          <p class="warning-text">
            Enter the same password you first entered in the Setup screen. 
            New settings will only take affect if the entered password is correct. 
          </p>

          <div id="form">
            <h3>Password*</h3>
            <input class="text-field" type="password" id="password" placeholder="Enter password*" required>

            <hr/>

            <h3>Quest Start Threshold</h3>
            <input class="text-field" type="number" id="questStartThreshold" placeholder="Enter percentage out of 100">

            <button class="button" id="form-submit-button" onclick="sumbitSettings()">Apply Settings</button>

            <i id="loading-bar"></i>
          </div>
        </div>
      </center>
    </main>
  </body>
</html>
