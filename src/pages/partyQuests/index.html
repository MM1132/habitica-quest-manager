<main>
  <div id="quests-section"></div>
</main>

<script>
  (() => {
    const asyncInclude = async (path, props) => {
      const includePromise = new Promise((resolve, reject) => {
        google.script.run
          .withSuccessHandler(resolve)
          .withFailureHandler(reject)
          .include(path, props);
      });

      try {
        return await includePromise;
      } catch (error) {
        console.error(`Failed to include ${path}:`, error);
      }
    }

    const setQuestsSection = async (quests) => {
      const questsSection = document.getElementById('quests-section');

      if (!quests) {
        questsSection.innerHTML = <?= include('pages/components/loading') ?>;
        return;
      }
      
      questsSection.innerHTML = await asyncInclude('pages/partyQuests/questsSection', { quests });
    }

    window.fetchData = async () => {
      await setQuestsSection();

      
      try {
        const data = new Promise((resolve, reject) => {
          google.script.run.withSuccessHandler(resolve).withFailureHandler(reject).getPartyQuestsPageData();
        });

        const { quests } = await data;

        await setQuestsSection(quests);
      } catch (error) {
        console.error('Failed to fetch data:', error);
      }
    }

    fetchData();
  })()
</script>